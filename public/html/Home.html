<!DOCTYPE html>
<html>
  <head>
    <title>URL Shortener</title>
    <link rel="stylesheet" href="../css/home.css" />
  </head>
  <body>
    <h1>URL Shortener</h1>
    <form action="/shortUrl/shorts" method="POST">
      <label for="longURL">Original URL:</label>
      <input type="text" id="longURL" name="longURL" required />
      <br />
      <label for="customURL">Custom URL (optional):</label>
      <input type="text" id="customURL" name="customURL" />
      <br />
      <button type="submit">Generate Short URL</button>
    </form>
    <div>
      <h2>Shortened URL:</h2>
      <table>
        <thead>
          <tr>
            <th>Long URL</th>
            <th>Short URL</th>
            <th>Custom URL</th>
            <th>Visits</th>
            <th>Generate QR Code</th>
          </tr>
        </thead>
        <tbody id="shortURLTableBody">
          <!-- <tr>
            <td>https://www.example.com/page1</td>
            <td>https://shorturl.com/abc123</td>
            <td>10</td>
            <td>
              <button class="generate-qr-button">Generate QR Code</button>
            </td>
          </tr>
          <tr>
            <td>https://www.example.com/page2</td>
            <td>https://shorturl.com/def456</td>
            <td>5</td>
            <td>
              <button class="generate-qr-button">Generate QR Code</button>
            </td>
          </tr>
          <tr>
            <td>https://www.example.com/page3</td>
            <td>https://shorturl.com/ghi789</td>
            <td>3</td>
            <td>
              <button class="generate-qr-button">Generate QR Code</button>
            </td>
          </tr> -->
        </tbody>
      </table>
    </div>
    <script>
      const shortURLTableBody = document.getElementById("shortURLTableBody");
      shortURLTableBody.addEventListener("click", async function (event) {
        if (event.target.classList.contains("generate-qr-button")) {
          const shortURL = event.target
            .closest("tr")
            .querySelector("td:nth-child(1)").textContent;
          console.log(shortURL);
          const response = await fetch("/shortUrl/generateQrCode", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ text: shortURL }),
          });

          if (response.ok) {
            const qrCodeBase64 = await response.text();
            const qrCodeDataUrl = "data:image/png;base64," + qrCodeBase64;
            console.log(qrCodeDataUrl)

            // Create a download link for the QR code image
            const link = document.createElement("a");
            link.href = qrCodeDataUrl;
            link.download = "qrcode.png";

            // Trigger a click event on the download link to initiate the download
            link.dispatchEvent(new MouseEvent("click"));
          } else {
            console.error("Error generating QR code:", response.status);
          }
        }
      });
    </script>
  </body>
</html>
